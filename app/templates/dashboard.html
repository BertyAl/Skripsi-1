
    {% extends 'base.html' %}
    {% block content %}
        <section class="hero-cta position-relative py-5">
            <div class="hero-cta__bg"></div>
            <div class="container" style="max-width:980px;">
                <h1 class="text-center fw-bold text-black mb-4">Optimasi Portofolio Saham IHSG</h1>

                <div class="mx-auto" style="max-width:640px;">
                    <form id="optim-form" action="{{ url_for('main.about') }}" method="post"
                          class="card p-4 shadow-lg bg-transparent border-0">

                        <!-- Input Dana -->
                        <div class="mb-3">
                            <label for="amount" class="form-label fw-semibold text-black">Masukkan Dana Anda (IDR):</label>
                            <input id="amount" name="amount" type="number" min="0" step="1000"
                                   class="form-control form-control-lg cta-input"
                                   placeholder="Masukkan nominal danaâ€¦" required>
                            <span class="input-hint">Contoh: 10000000</span>
                        </div>

                        <!-- Pilih Saham IHSG -->
                        <div class="mb-3">
                            <label class="form-label fw-semibold text-black">Pilih Saham IHSG</label>

                            <!-- Search bar -->
                            <input id="ticker-search" type="text" class="form-control form-control-lg mb-3"
                                   placeholder="Cari saham (ketik min. 3 huruf, mis. 'BBR' atau 'tel')"
                                   autocomplete="off">
                            <div id="searchHelp" class="form-text mb-2">
                                Ketik minimal 3 huruf untuk memfilter berdasarkan <em>kode</em> atau <em>nama</em>.
                            </div>

                            {% if tickers and tickers|length > 0 %}
                                <div class="d-flex justify-content-between mb-2">
                                    <button type="button" id="select-all" class="btn btn-sm btn-outline-primary">Pilih Semua</button>
                                    <button type="button" id="clear-all" class="btn btn-sm btn-outline-secondary">Hapus Semua</button>
                                </div>

                                <div id="ticker-list" class="border rounded p-3" style="max-height: 300px; overflow-y: auto;">
                                    {% for code, name in tickers %}
                                        <div class="form-check mb-1">
                                            <input class="form-check-input" type="checkbox" name="tickers[]" id="tick_{{ loop.index }}" value="{{ code }}">
                                            <label class="form-check-label" for="tick_{{ loop.index }}">
                                                <strong>{{ code }}</strong> â€” {{ name }}
                                            </label>
                                        </div>
                                    {% endfor %}
                                </div>
                                <div class="form-text">Centang saham yang ingin Anda gunakan (tanpa perlu menekan Ctrl).</div>
                            {% else %}
                                <div class="alert alert-warning">
                                    Daftar saham tidak tersedia. Pastikan file <code>Data/Ticker/ihsg_tickers.CSV</code> ada dan berisi kolom <strong>code,name</strong>.
                                </div>
                            {% endif %}
                        </div>

                        <!-- ALERT: Sedang Training -->
                        <div id="training-alert" class="alert alert-info d-none mt-3" role="alert">
                            <div class="d-flex align-items-center gap-2">
                                <div class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></div>
                                <div><strong>Sedang melakukan training modelâ€¦</strong> Mohon tunggu sebentar.</div>
                            </div>
                        </div>

                        <!-- Tombol Submit -->
                        <button id="submit-btn" type="submit"
                                class="btn btn-primary btn-lg w-50 rounded-3 fw-semibold d-block mx-auto"
                                {% if not tickers or tickers|length == 0 %}disabled{% endif %}>
                            Tampilkan Rekomendasi
                        </button>
                    </form>
                </div>
            </div>
        </section>

        <!-- JS -->
        <script>
            (function(){
                // ðŸ” Filter pencarian saham
                const searchInput = document.getElementById('ticker-search');
                const container   = document.getElementById('ticker-list');
                if (searchInput && container) {
                    const items = Array.from(container.querySelectorAll('.form-check'));
                    const debounce = (fn, wait=150) => { let t; return (...a)=>{clearTimeout(t);t=setTimeout(()=>fn(...a),wait);} };
                    const onSearch = debounce(()=>{
                        const q = (searchInput.value || '').trim().toLowerCase();
                        items.forEach(div=>{
                            const text = div.textContent.toLowerCase();
                            div.style.display = (q.length<3 || text.includes(q)) ? '' : 'none';
                        });
                    });
                    searchInput.addEventListener('input', onSearch);
                }

                // ðŸ”˜ Pilih Semua / Hapus Semua
                const selectAllBtn = document.getElementById('select-all');
                const clearAllBtn  = document.getElementById('clear-all');
                if (selectAllBtn && clearAllBtn && container) {
                    selectAllBtn.addEventListener('click', ()=> {
                        container.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = true);
                    });
                    clearAllBtn.addEventListener('click', ()=> {
                        container.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
                    });
                }

                // âš™ï¸ Alert training saat submit
                const form   = document.getElementById('optim-form');
                const alert  = document.getElementById('training-alert');
                const submit = document.getElementById('submit-btn');
                if (form) {
                    form.addEventListener('submit', () => {
                        alert.classList.remove('d-none');
                        {#Array.from(form.elements).forEach(el => el.disabled = true);      #}
                        submit.disabled = true;
                        submit.innerHTML =
                            '<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span> Melatih modelâ€¦';
                        submit.classList.add('disabled');
                    });
                }
            })();
        </script>
    {% endblock %}

